/** @param {NS} ns **/
export async function main(ns) {
	// Server object
	const vServer = {};
	vServer.name = ns.args[0];
	// Hacks per second rate
	vServer.HPS = 1;
	// Minutes for hack to run;
	vServer.time = ns.args[1];

	// Get HGW properties
	const vHack = {};
	const vGrow = {};
	const vWeak = {};
	vHack.time = ns.getHackTime(vServer.name);
	vGrow.time = ns.getGrowTime(vServer.name);
	vWeak.time = ns.getWeakenTime(vServer.name);
	vHack.ram = 0.1;
	vGrow.ram = 0.15;
	vWeak.ram = 0.15;
	vHack.security = 0.002;
	vGrow.security = 0.004;
	vWeak.security = 0.05;

	// Server stats
	vServer.currentMoney = ns.getServerMoneyAvailable(vServer.name);
	vServer.maxMoney = ns.getServerMaxMoney(vServer.name);
	vServer.diffMoney = ((vServer.maxMoney - vServer.currentMoney) / vServer.maxMoney);
	vServer.growNeeded = Math.ceil(ns.growthAnalyze(vServer.name, (1 + vServer.diffMoney)));
	vServer.growram = (vServer.growNeeded * vGrow.ram);
	vServer.growSecInc = (vServer.growNeeded * vGrow.security);
	vServer.currSecurity = ns.getServerSecurityLevel(vServer.name);
	vServer.minSecurity = ns.getServerMinSecurityLevel(vServer.name);
	vServer.diffSecurity = (vServer.currSecurity + vServer.growSecInc - vServer.minSecurity);
	// Get weaken threads to min server sec
	if (vServer.diffSecurity > vWeak.security) {
		vServer.weakNeeded = Math.ceil(vServer.diffSecurity / vWeak.security);
	} else {
		vServer.weakNeeded = 1;
	}
	// Get ns.weaken() RAM cost
	vServer.weakram = (vServer.weakNeeded * vWeak.ram);
	
	// Get purchased server names, mine are called orcs :)
	const vOrcNamesArray = ns.getPurchasedServers();
	// Create array to gather the object names
	const orcServers = [];
	// Create purchased server objects
	for (let i = 0; i < vOrcNamesArray.length; i++) {
		let orc = "orc_" + i;
		// Add object name to array
		orcServers.push(orc);
		const orc = {};
		orc.name = vOrcNamesArray[i];
		orc.ram = ns.getServerMaxRam(orc.name);
		orc.ramLeft = orc.ram;
		orc.prepGrwThrd = 0;
		orc.prepWkThrd = 0;
		orc.hackThread = 0;
		orc.hackCount = 0;
		orc.growThread = 0;
		orc.growCount = 0;
		orc.weakThread = 0;
		orc.weakCount = 0;
	}
	// Check if we can prep the target server
	// We are trying to make a function to see how to split
	// max threaded grow and weaken to prep the server for
	// hacking.
	function prepRamUse(method,methodThread,methodRam) {
		let orcRamLeft = 0;
		// Add up available ram on hack servers
		for (let i = 0; i < orcServers.length; i++) {
			orcRamLeft += orcRamorcServers[i].ramLeft;
		}
		if (orcRamLeft > methodRam) {
			let methodThreadCount = methodThread;
			// If there is enough ram across all hacker servers
			// then portion out the method's threads.
			let methodRamLeft = methodRam;
			// Loop all hacker servers
			for (let i = 0; i < orcServers.length; i++) {
				// If remaining method stats fit on one server
				if (orcServers[i].ramLeft > (methodRamLeft + 1.6)) {
					// Update the remaining ram on hack server
					orcServers[i].ramLeft -= (methodRamLeft + 1.6);
					// Call specific grow or weaken object properties
					if (method = 'grow') {
						// Add threads to hack server object thread count
						orcServers[i].prepGrwThrd += methodThreadCount;
					} else {
						// Add threads to hack server weaken thread count
						orcServers[i].prepWkThrd += methodThreadCount;
					}
					// Break the loop as all threads should be assigned
					break;
				}
				else {
					// If one thread will not fit on hack server continue
					if (orcServers[i].ramLeft < (1.6 + 0.15)) {
						continue
					} else {
						orcServers[i].ramLeft -= 1.6;
					}
					// Figure out how many threads will fit on the hack server
					if (method = 'grow') {
						orcServers[i].prepGrwThrd += 
							(Math.floor(orcServers[i].ramLeft / vGrow.ram));
						methodThreadCount -= orcServers[i].prepGrwThrd;
					} else {
						orcServers[i].ramLeft
					}
				}
			}
		} else {
			ns.tprint("EXITED: Script requires more RAM than available.");
			ns.exit();
		}
	}
	prepRamUse('grow', vServer.growNeeded, vServer.growram);
	prepRamUse('weaken', vServer.weakThread, vServer.weakram);
}
